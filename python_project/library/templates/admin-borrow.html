{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tạo phiếu mượn — Admin Borrow</title>
    <link rel="stylesheet" href="{% static 'css/admin-borrow.css' %}?v={{ timestamp }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>

<body hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
<div class="page-container">
    <!-- Main two-column layout -->
    <main class="borrow-layout">

        <!-- LEFT SIDE – Borrow Ticket -->
        <div class="ticket-card card">
            <h2 class="section-title">Thông tin phiếu mượn</h2>

            <label for="user-id">User ID:</label>
            <input id="user-id" type="text" placeholder="Nhập User ID..." />

            <label for="borrow-date">Ngày mượn:</label>
            <input id="borrow-date" type="date" value="{{ today_date }}" />

            <label for="return-date">Ngày trả dự kiến:</label>
            <input id="return-date" type="date" />

            <h3 class="borrow-info-title">Thông tin mượn</h3>
            <ul class="borrow-list-ul">
                <!-- Filled by JS when admin adds books -->
            </ul>

            <button class="confirm-btn">Xác nhận tạo phiếu</button>
            <hr style="margin: 20px 0;">
            <div id="auto-pending-zone"
                 hx-get="{% url 'get_pending_requests' %}"
                 hx-trigger="load, every 2s">
                 <p>Đang tải danh sách chờ...</p>
            </div>
        </div>

        <!-- RIGHT SIDE – Book Search -->
        <div class="search-card card">
            <h2 class="section-title">Tìm sách</h2>

            <div class="search-box">
                <input id="book-search"
                       type="text"
                       name="q"
                       placeholder="Nhập Book ID hoặc tên sách..."

                       hx-get="{% url 'search_book_admin' %}"
                       hx-trigger="keyup changed delay:500ms, search"
                       hx-target="#search-result"
                />
                <button id="btn-search" class="search-btn"
                        type="button"
                        hx-include="#book-search"
                        hx-get="{% url 'search_book_admin' %}"
                        hx-target="#search-result">
                    <i class="fas fa-search"></i> Tìm
                </button>
            </div>
            <div id="search-result" class="search-result"></div>
        </div>
    </main>
</div>

<script>
// Example: client-side glue for Add button (keeps previous behavior)
document.addEventListener("click", (e) => {
    if (e.target.classList.contains("add-btn")) {
        const list = document.querySelector(".borrow-list-ul");
        const id = e.target.dataset.bookid;
        const title = e.target.dataset.title;

        const li = document.createElement("li");
        li.textContent = id + " – " + title;

        // Thêm hidden input để khi submit form gửi được dữ liệu về server
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = "book_ids";
        input.value = id;
        li.appendChild(input);

        list.appendChild(li);
    }
});

</script>

</body>
</html>