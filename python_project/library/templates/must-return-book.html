{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sách cần hoàn trả</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/must-return-book.css' %}">
</head>
<body>

    <div class="borrow-wrapper">
        <div class="warning-panel">
            <div class="warning-icon-box">
                <i class="fa-solid fa-triangle-exclamation"></i>
            </div>
            <div class="warning-content">
                <strong>Lưu ý quan trọng</strong>
                <span>Bạn cần phải tới thư viện trả sách. Nếu không trả sách đúng hạn, bạn sẽ không thể hoàn thiện việc ra trường đúng hạn.</span>
            </div>
        </div>

        <div class="content-panel" style="margin-bottom: 30px;">
            <h3 class="panel-title">Hiện tại: Sách cần hoàn trả & Số tiền nợ</h3>

            <div class="table-responsive">
                <table class="debt-table">
                    <thead>
                        <tr>
                            <th style="width: 35%;">Tên sách</th>
                            <th style="width: 20%;">Hạn trả</th>
                            <th style="width: 15%;">Tiền phạt tạm tính</th>
                            <th style="width: 20%;">Trạng thái</th>
                            <th style="width: 10%; text-align: center;">Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr>
                            <td>
                                <div class="book-info">
                                    <div class="book-icon">
                                        <i class="fa-solid fa-book"></i>
                                    </div>
                                    <span class="book-name">{{ item.book_name }}</span>
                                </div>
                            </td>
                            <td class="date-cell">{{ item.due_date|date:"d/m/Y" }}</td>
                            <td>
                                {% if item.amount > 0 %}
                                    <span class="amount-debt">{{ item.amount|intcomma }} đ</span>
                                {% else %}
                                    <span class="amount-zero">0 đ</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="status-badge" style="{{ item.status_color }}">
                                    {% if item.is_overdue %}
                                        <i class="fa-solid fa-circle-exclamation"></i>
                                    {% endif %}
                                    {{ item.status_label }}
                                </span>
                            </td>
                            <td class="action-cell">
                                {% if item.amount > 0 %}
                                    <i class="btn-action btn-pay">Đang nợ</i>
                                {% else %}
                                    <button class="btn-action btn-disabled" disabled>Chưa có phí</button>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5">
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <i class="fa-solid fa-check"></i>
                                    </div>
                                    <p>Hiện tại bạn không mượn cuốn nào.</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="content-panel">
            <h3 class="panel-title">Lịch sử: Sách đã trả & Đã thanh toán</h3>

            <div class="table-responsive">
                <table class="debt-table">
                    <thead>
                        <tr>
                            <th style="width: 35%;">Tên sách</th>
                            <th style="width: 20%;">Ngày thực trả</th>
                            <th style="width: 15%;">Tiền phạt đã đóng</th>
                            <th style="width: 20%;">Ghi chú</th>
                            <th style="width: 10%; text-align: center;">Kết quả</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in history_items %}
                        <tr>
                            <td>
                                <div class="book-info">
                                    <div class="book-icon" style="background: #f1f5f9; color: #64748b;">
                                        <i class="fa-solid fa-book-open"></i>
                                    </div>
                                    <span class="book-name" style="color: #4b5563;">{{ item.book_name }}</span>
                                </div>
                            </td>
                            <td class="date-cell">{{ item.due_date|date:"d/m/Y" }}</td>
                            <td>
                                {% if item.amount > 0 %}
                                    <span class="amount-debt" style="color: #b91c1c; background: #fef2f2;">{{ item.amount|intcomma }} đ</span>
                                {% else %}
                                    <span class="amount-zero" style="color: #6b7280;">0 đ</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="status-badge" style="{{ item.status_color }}">
                                    {{ item.status_label }}
                                </span>
                            </td>
                            <td class="action-cell">
                                <button class="btn-action" style="background: #ecfdf5; color: #059669; border: 1px solid #a7f3d0; cursor: default;">
                                    <i class="fa-solid fa-check"></i> Hoàn tất
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5">
                                <div class="empty-state">
                                    <p>Chưa có lịch sử trả sách nào.</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

</body>
</html>